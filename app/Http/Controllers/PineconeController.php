<?php
// app/Http/Controllers/PineconeController.php

namespace App\Http\Controllers;


use App\Service\PineconeService;
use App\Service\QueryEmbedding;
use Illuminate\Http\Request;

class PineconeController extends Controller
{


    protected PineconeService $pinecone;
    protected QueryEmbedding $query;

    public function __construct(QueryEmbedding $query , PineconeService $pinecone)
    {
        $this->query = $query;
        $this->pinecone = $pinecone;
    }


    public function checkConnection()
    {
        $question = "騷擾";
        //$queryVectors =[0.66,0.18,0.44,0.77,0.83,0.65,0.68,0.63,0.69,0.04,0.7,0,0.57,0.21,0.2,0.88,0.71,0.6,0.65,0.27,0.18,0.96,0.98,0.97,0.64,0.07,0.78,0.28,0.14,0.72,0.18,0.62,0.87,0.15,0.89,0.04,0.45,0.2,0.77,0.85,0.89,0.98,0.98,0.68,0.08,0.16,0.8,0.28,0.04,0.42,0.32,0.22,0.14,0.63,0.47,0.84,0.95,0.97,0.31,0.18,0.78,0.88,0.1,0.95,0.11,0.29,0.37,0.75,0.35,0.07,0.64,0.06,0.92,0.42,0.8,0.22,0.26,0.97,0.52,0.08,0.28,0.95,0.37,0.58,0.24,0.35,0.98,0.57,0.93,0.7,0.4,0.76,0.63,0.61,0.19,0.02,0.9,0.68,0.03,0.44,0.95,0.01,0.04,0.96,0.89,0.9,0.87,0.58,0.1,0.76,0.8,0.32,0.43,0.3,0.38,0.47,0.12,0.41,0.09,0.32,0.61,0.07,0.46,0.96,0.35,0.68,0.02,0.82,0.74,0.68,0.16,0.22,0.57,0.44,0.89,0.43,0.21,0.18,0.89,0.64,0.75,0.68,0.04,0.17,0.1,0.9,0.59,0.35,0.39,0.33,0.65,0.73,0.58,0.92,0.63,0.64,0.49,0.21,0.97,0.77,0.64,0.41,0.64,0.34,0.23,0.71,0.04,0.57,0.26,0.7,0.09,0.99,0.93,0.08,0.56,0.98,0.93,0.17,0.83,0.47,0.29,0.92,0.09,0.55,0.21,0.4,0.73,0.66,0.64,0.05,0.02,0.97,0.2,0.16,0.15,0.48,0.8,0.25,0.74,0.97,0.14,0.66,0.26,0.79,0.13,0.93,0.88,0.49,0.47,0.71,0.99,0.94,0.3,0.6,0.04,0.43,0.71,0.65,0.6,0.72,0.52,0.76,0.55,0.9,0.84,0.28,0.84,0.69,0.16,0.27,0.52,0.02,0.72,0.34,0.93,0.88,0.41,0.09,0.15,0.2,0.22,0.34,0.29,0.63,0.89,0.89,0.67,0.05,0.03,0.3,0.78,0.88,0.82,0.91,0.25,0.82,0.17,0.45,0.75,0.55,0.59,0.92,0.94,0.5,0.43,0.72,0.29,0.86,0.87,0.03,0.14,0.09,0.45,0.52,0.65,0.92,0.23,0.52,0.97,0.3,0.02,0.03,0.73,0.52,0.21,0.09,0.06,0.34,0.65,0.7,0.98,0.48,0.46,0.75,0.16,0.42,0.05,0.65,0.69,0.36,0.95,0.78,0.34,0.52,0.99,0.45,0.47,0.2,0.55,0.62,0.6,0.89,1,0.62,0.35,0.1,0.17,0.69,0.61,0.57,0.53,0.62,0.21,0.96,0.24,0.28,0.82,0.47,0.91,0.82,0.72,0.02,0.79,0.69,0.78,0.12,0.27,0.08,0.41,0.08,0.2,0.53,0.81,0.98,0.51,0,0.84,0.59,0.82,0.24,0.66,0.24,0.9,0.22,0.56,0.37,0.48,0.34,0.26,0.29,0.53,0.87,0.38,0.85,0.63,0.5,0.9,0.97,0,0.26,0.87,0.02,0.49,0.34,0.5,0.42,0.27,0,0.1,0.69,0.31,0.03,0.91,0.52,0.62,0.63,0.01,0.49,0.66,0.99,0.08,0.82,0.64,0.08,0.58,0.55,0.2,0.02,0.54,0.89,0.82,0.65,0.5,0.49,0.39,0.23,0.42,0.31,0.71,0.03,0.97,0.65,0.1,0.93,0.96,0.28,0.88,0.77,0.89,0.33,0.73,0.77,0.1,0.01,0.01,0.01,0.5,0.8,0.77,0.65,0.03,0.25,0.06,0.89,0.73,0.29,0.34,0.01,0.74,0.59,0.76,0.14,0.63,0.34,0.48,0.63,0.13,0.47,0.79,0.31,0.35,0.59,0.05,0.74,0.59,0.95,0.26,0.69,0.79,0.93,0.21,0.67,0.59,0.42,0.9,0.78,0.57,0.83,0.3,0.23,0.7,0.87,0.17,0.88,0.2,0.92,0.69,0.11,0.04,0.9,0.45,0.41,0.64,0.62,0.87,0.79,0.06,0.89,0.38,0.86,0.78,0.08,0.62,0.88,0.22,0.58,0.11,0.38,0.16,0.27,0.81,0.43,0.29,0.82,0.8,0.88,0.85,0.27,0.05,0.03,0.53,0.07,0.55,0.3,0.07,0.69,0.07,0.28,0.48,0.07,0.49,0.62,0.42,0.74,0.58,0.23,0.84,0.38,0.39,0.5,0.02,0.26,0.16,0.18,0.28,0.3,0.92,0.93,0.03,0.98,0.31,0.92,0.91,0.47,0.67,0.12,0.04,0.62,0.96,0.97,0.82,0.86,0.34,0.16,0.63,0.34,0.7,0.82,0.84,0.43,0.26,0.21,0.69,0.82,0.46,0.43,0.64,0.43,0.56,0.07,0.01,0.48,0.76,0.42,0.73,0.72,0.85,0.84,0.18,0.73,0.4,0.75,0.63,0.29,0.3,0.35,0.41,0.81,0.76,0.5,0.34,0.01,0.23,0.42,0.37,0.4,0.74,0.93,0.36,0.34,0.61,0,0.49,0.47,0.56,0.63,0.94,0.03,0.22,0.26,0.97,0.85,0.78,0.47,0.5,0.88,0.49,0.95,0.69,0.76,0.79,0.95,0.38,0.07,1,0.03,0.77,0.89,0.07,0.33,0.75,0.21,0.93,0.25,0.32,0.11,0.71,0.42,0,0.93,0.08,0.28,0.72,0.89,0.98,0.25,0.99,0.77,0.81,0.15,0.12,0.52,0.93,0.33,0.98,0.7,0,0.96,0.24,0.92,0.08,0.37,0,0.7,0.14,0.66,0.94,0.78,0.32,0.83,0.63,0.2,0.1,0.9,0.8,0.4,0.29,0.51,0.49,0.38,0.6,0.75,0.11,0.56,0.33,0.57,0.48,0.29,0.41,0.03,0.73,0.56,0.33,0.19,0.55,0.71,0.86,0.93,0.76,0.45,0.75,0.03,0.98,0.38,0.27,0.66,0.16,0.21,0.57,0.89,0.63,0.72,1,0.82,0.8,0.67,0.6,0.47,0.43,0.28,0.02,0.99,0.28,0.38,0.86,0.34,0.76,0.4,0.81,0.61,0.69,0.87,0.79,0.67,0.08,0.03,0.81,0.31,0,0.82,0.61,0.46,0.22,0.28,0.64,0.43,0.14,0.04,0.51,0.16,0.36,0.82,0.77,0.1,0.8,0.3,0.1,0.16,0.35,0.87,0.8,0.35,0.47,0.2,0.5,0.71,0.14,0.57,0.06,0.33,0.05,0.35,0.02,0.42,0.1,0.42,0.42,0.79,0.68,0.13,0.39,0.41,0.99,0.23,0.9,0.99,0.06,0.95,0.55,0.73,0.97,0.76,0.42,0.36,0.4,0.1,0.89,0.17,0.08,0.4,0.83,0.91,0.23,0.52,0.57,0.78,0.72,0.17,0.47,0.45,0.92,0.94,0.07,0.94,0.39,0.96,0.03,0.83,0.86,0.34,0.88,0.05,0.25,0.47,0.46,0,0.42,0.32,0.25,0.55,0.53,0.16,0.18,0.58,0.81,0.52,0.09,0.86,0.49,0.04,0.31,0.5,0.65,0.5,0,0.36,0.88,0.14,0.28,0.64,0.61,0.92,0.3,0.06,0.45,0.3,0.69,0.25,0.16,0.31,0.68,0.36,0.38,0.14,0.48,0.55,0.82,0.31,0.08,0.89,0.75,0.22,0.79,0.56,0.36,0.49,0.48,0.28,0.72,0.5,0.46,0.8,0.03,0.22,0.63,0.18,0.42,0.98,0.5,0.97,0.28,0.55,0.11,0.96,0.05,0.38,0.58,0.17,0.85,0.61,0.09,0.45,0.61,0.04,0.93,0.57,0.53,0.75,0.4,0.12,0.18,0.68,0.36,0.03,0.64,0.81,0.52,0.36,0.83,0.6,0.31,0.74,0.77,0.56,0.17,0.29,0.63,0.94,0.07,0.84,0.67,0.57,0.63,0.34,0.09,0.44,0.25,0.53,0.16,0.41,0.96,0.97,0.36,0.66,0.81,0.43,0.88,0.83,0.92,0.58,0.32,0.71,0.37,0.65,0.13,0.66,0.36,0.9,0.02,0.45,0.53,0.84,0.49,0.89,0.86,0.58,0.15,0.19,0.31,0.25,0.22,0.13,0.35,0.04,0.45,0.38,0.06,0.16,0.38,0.37,0.17,0.23,0.49,0.14,0.6,0.96,0.29,0.18,0.31,0.53,0.17,0.23,0.8,0.88,0.52,0.71,0.96,0.45,0.89,0.13,0.83,0.11,0.86,0.54,0.85,0.64,0.3,0.52,0.81,0.58,0.71,0.47,0.82,0.34,0.24,0.64,0.87,0.73,0.27,0.73,0.5,0.88,0.33,0.48,0.08,0.61,0.88,0.57,0.39,0.16,0.83,0.56,0.59,0.71,0.32,0.58,0.21,0.29,0.25,0.37,0.82,0.35,0.23,0.37,0.5,0.85,0.14,0.65,0.38,0.06,0.96,0.87,0.27,0.11,0.96,0.25,0.77,0.18,0.31,0.71,0.85,0.68,0.75,0.25,0.15,0.99,0.4,0.29,0.42,0.01,0.43,0.75,0.59,0.68,0.85,0.83,0.54,0.84,0.88,0.36,0.96,0.08,0.81,0.42,0.89,0.08,0.67,0.15,0.27,0.37,0.36,0.61,0.59,0.81,0.79,0.72,0.39,0.09,0.64,0.81,0.49,0.57,0.05,0.06,0.89,0.2,0.97,0.04,0.07,0.45,0.64,0.56,0.62,0.33,0.64,0.85,0.47,0.17,0.59,0.45,0.39,0.87,0.57,0.68,0.72,0.87,0.28,0.95,0.85,0.42,0.25,0.99,0.62,0.01,0.68,0.98,0.8,0.09,0.97,0.88,0.54,0.38,0.6,0.75,0.8,0.26,0.76,0.85,0.87,0.36,0.07,0.58,0.67,0.58,0.65,0.08,0.46,0.42,0.12,0.19,0.49,0.56,0.44,0.14,0.74,0.41,0.67,0.63,0.4,0.72,0.57,0.05,0,0.7,0.77,0.78,0.72,0.57,0.1,0.12,0.44,0.78,0.26,0.67,0.3,0.21,0.45,0.04,0.99,0.27,0.68,0.68,0.62,0.57,0.97,0.87,0.24,0.76,0.38,0.05,0.46,0.11,0.35,0.82,0.78,0.32,0.18,0.63,0.35,0.03,0.9,0.09,0.91,0.82,0.46,0.55,0.04,0.31,0.99,0.2,0.68,0.61,0.53,0.34,0.24,0.63,0.82,0.93,0.24,0.87,0.38,0.35,0.09,0.5,0.69,0.53,0.32,0.95,0.81,0.72,0.36,0.9,0.72,0.71,0.54,0.73,0.19,0.11,0.01,0.22,0.34,0.39,0.39,0.34,0.49,0.74,0.65,0.34,0.78,0.82,0.47,0.88,0.29,0.18,0.37,0.28,0.32,0.75,0.19,0.12,0.12,0.52,0.28,0.93,0.5,0.16,0.22,0.61,0.42,0.92,0.17,0.73,0.76,0.69,0.51,0.79,0.95,0.01,0.35,0.15,0.95,0.92,0.72,0.76,0.11,0.31,0.48,0.61,0.95,0.11,0.04,0.28,0.36,0.74,0.44,0.26,0.94,0.61,0.5,0.46,0.41,0.56,0.79,0.52,0.53,0.6,0.63,0.53,0.46,0.81,0.85,0.52,0.35,0.85,0.5,0.08,0.68,0.04,0.74,0.45,0.86,0.25,0.51,0.89,0.03,0.66,0.64,0.71,0.9,0.69,0.51,0.51,0.74,0.91,0.12,0.72,0.48,0.82,0.27,0.99,0.11,0.15,0,0.15,0.47,0.1,0.33,0.89,0.03,0.02,0.46,0.33,0.68,0.46,0.77,0.18,0.65,0.41,0.56,0.87,0.76,0.65,0.39,0.95,0.54,0.32,0.75,0.15,0.51,0.87,0.82,0.93,1,0.45,0.69,0.97,0.05,0.3,0.29,0.68,0.14,0.86,0.97,0.57,0.99,0.15,0.31,0.15,0.41,0.06,0.63,0.12,0.57,0.61,0.44,0.77,0.29,0.37,0.81,0.86,0.2,0.03,0.28,0.15,0.43,0.02,0.9,0.9,0.96,0.41,0.59,0.13,0.61,0.75,0.79,0.89,0.43,0.59,0.2,0.9,0.93,0.64,0.93,0.74,0.7,0.24,0.59,0.53,0.47,0.31,0.39,0.14,0.15,0.09,0.21,0.06,0.87,0.43,0.04,0.81,0.33,0.34,0.74,0.61,0.09,0.84,0.84,0.07,0.1,0.69,0.27,0.63,0.73,0.14,0.61,0.27,0.79,0.51,0.87,0.82,0.17,0.41,0.66,0.93,0.41,0.11,0.4,0.72,0.4,0.59,0.17,0.02,0.55,0.21,0.74,0.65,0.1,0.52,0.76,0.04,0.52,0.42,0.25,0.48,0.18,0.18,0.44,0.48,0.98,0.43,0.51,0.65,0.28,0.03,0.14,0.7,0.04,0.68,0.33,0.63,0.59,0.53,0.63,0.22,0.7,0.38,0.99,0.89,0.61,0.39,0.05,0.61,0.69,0.34,0.43,0.31,0.63,0.73,0.83,0.06,0.66,0.01,0.82,0.74,0.81,0.85];
        //$queryVectors = $this->query->getQueryEmbedding($question);//將問題轉換成向量
        //$response = $this->pineconeService->verifyConnection($queryVectors);

        $response = $this->pinecone->GetRelevantContent($question);//提取text
        // 假設 $response 是從 JSON 解碼得到的一個陣列。


        // 檢查 'matches' 鍵是否存在並且是一個陣列。
        /*
        if (isset($response['matches']) && is_array($response['matches'])) {
            foreach ($response['matches'] as $match) {
                // 檢查 'metadata' 是否存在並且有 'text' 鍵。
                if (isset($match['metadata']) && isset($match['metadata']['text'])) {
                    $textValues[] = $match['metadata']['text'];
                    }
                }
                }*/
        //$matches=[];
        //dd($connectionStatus);
        // 可以根据需要返回视图或其他响应类型



        return $response;

    }
}
