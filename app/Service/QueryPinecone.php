<?php

namespace App\Service;

use Exception;
//use GuzzleHttp\Client;
use Probots\Pinecone\Client as Pinecone;

class QueryPinecone
{
    public Pinecone $pinecone;

    public function __construct()
    {
        $this->pinecone = new Pinecone(env('PINECONE_API_KEY') ?? '', env('PINECONE_ENVIRONMENT') ?? '');

        $this->apiKey = env('PINECONE_API_KEY');
        /*
        $this->client = new Client([
            'base_uri' => $this->indexUrl,
            'headers' => [
                'Api-Key' => $this->apiKey,
                'Content-Type' => 'application/json'
            ]
        ]);*/
    }
    public function queryPinecone($queryVectors)
    {

        try {
                $response = $this->pinecone->data()->vectors()->query(
                namespace: 'pdf-test',
                vector: [0.81,0.49,0.42,0.9,0.11,0.68,0.01,0.93,0.38,0.64,0.01,0.33,0.22,0.98,0.69,0.27,0.96,0.04,0.08,0.93,0.1,0.12,0.67,0.32,0.07,0.42,0.38,0.2,0.09,0.33,0.58,1,0.08,0.51,0.93,0.14,0.03,0.47,0.56,1,0.71,0.32,0.81,0.38,0.68,0.09,0.61,0.13,0.85,0.93,0.16,0.85,0.88,0.74,0.1,0.85,0.22,0.69,0.49,0.05,0.17,0.34,0.95,0.2,0,0.37,0.12,0.18,0.22,0.45,0.55,0.16,0.22,0.89,0.85,0.95,0.41,0.78,0.56,0.54,0.05,0.56,0.28,0.33,0.04,0.91,0.12,0.26,0.38,0.74,0.61,0.69,0.48,0.66,0.88,0.78,0.01,0.68,0.73,0.42,0.74,0.94,0.96,0.65,0.89,0.37,0.71,0.03,0.36,0.15,0.54,0.26,0.62,0.28,0.23,0.7,0.49,0.04,0.1,0.97,0.52,0.82,0.58,0.16,0.37,0.2,0.57,0.59,0.97,0.15,0.65,0.59,0.11,0.26,0.4,0.38,0.91,0.19,0.24,0.78,0.19,0.78,0.08,0.17,0.77,0.93,0.03,0.98,0.58,0.79,0.37,0.25,0.05,0.86,0.84,0.97,0.22,0.45,0.29,0.35,0.86,0.97,0.14,0.02,0.77,0.31,1,0.98,1,0.78,0.66,0.6,0.06,0.2,0.33,0.67,0.52,0.92,0.91,0.18,0.42,0.45,0.46,0.12,0.98,0.44,0.3,0.52,0.55,0.4,0.8,0.2,0.41,0.91,0.32,0.84,0.39,0.59,0.56,0.1,0.88,0.08,0.05,0.36,0.44,0.26,0.56,0.68,0.84,0.77,0.58,0.6,0.06,0.67,0.05,0.26,0.9,0.63,0.18,0.25,0.76,0.25,0.88,0.7,0.18,0.69,0.33,0.11,0.56,0.6,0.04,0.38,0.43,0.97,0.88,0.53,0.88,0.97,0.42,0.76,0.01,0.72,0.29,0.81,0.46,0.34,0.42,0.75,0.58,0.64,0.01,0.8,0.21,0.35,0.18,0.32,0.21,0.61,0.96,0.04,0.6,0.2,0.91,0.15,0.43,0.05,0.33,0.58,0.56,0.16,0.06,0.2,0.07,0.74,0.92,0.17,0.08,0.05,0.76,0.94,0.77,0.13,0.73,0.72,0.87,0.51,0.18,0.68,0.17,0.56,0.94,0.82,0.97,0,0.09,0.9,0.29,0.44,0.75,0.95,0.48,0.49,0.37,0.23,0.94,0.15,0.42,0.82,0.15,0.1,1,0.67,0.43,0.62,0.3,0.49,0.89,0.84,0.89,0.42,0.04,0.23,0.06,0.37,0.94,0.97,0.96,0.87,0.18,0.01,0.43,0.78,0.46,0.77,0.16,0.3,0.16,0.71,0.8,0.87,0.75,0.71,0.34,0.31,0.15,0.9,0.06,0.43,0.94,0.88,0.88,0.24,0.79,0.1,0.68,0.04,0.06,0.11,0.92,0.6,0.08,0.05,0.32,0.74,0.5,0.55,0.25,0.42,0.16,0.48,0.86,0.67,0.34,0.7,0.27,0.58,0.69,0.43,0.43,0.57,0.19,0.83,0.82,0.1,0.91,0.62,0.57,0.5,0.98,0.82,0.78,0.62,0.54,0.21,0.49,0.38,0.13,0.22,0.44,0.18,0.17,0.65,0.21,0.88,0.81,0.39,0.16,0.03,0.11,0.91,0.78,0.18,0.16,0.54,0.38,0.33,0.69,0.84,0.16,0.66,0.93,0.49,0.56,0.12,0.31,0.56,0.18,0.4,0.17,0.81,0.71,0.86,0.05,0.85,0.95,0.44,0.08,0.78,0.55,0.56,0.15,0.99,0.62,0.21,0.2,0.95,0.74,0.92,0.14,0.29,0.22,0.47,0.01,0.76,0.57,0.44,0.17,0.69,0.98,0.23,0.81,0.63,0.76,0.4,0.64,0.86,0.5,0.9,0.35,0.96,0.94,0.55,0.43,0.2,0.18,0.98,0.13,0.93,0.57,0.95,0.07,0.5,0.01,0.95,0.2,0.12,0.69,0.38,0.5,0.55,0.45,0.42,0.01,0.35,0.77,0.3,0.49,0.83,0.71,0.46,0.04,0.98,0.89,0.51,0.56,0.88,0.16,0.8,0.03,0.3,0.35,0.79,0.29,0.36,0.65,0.03,0.76,0.31,0.6,0.59,0.48,0.27,0.67,0.57,0.24,0.45,0.52,0.07,0.85,0.55,0.73,0.76,0.03,0.12,0.19,0.07,0.29,0.18,0.27,0.4,0.08,0.21,0.86,0.29,0.14,0.33,0.77,0.38,0.59,0.43,0.33,0.78,0.89,0.17,0.84,0.8,0.08,1,0.02,1,0.87,0.47,0.33,0.15,0.43,0.19,0.52,0.83,0.62,0.2,0.59,0.17,0.88,0.34,0.71,0.74,0.76,0.18,0.2,0.61,0.25,0.14,0.13,0.86,0.96,0.86,0.38,0.89,0.75,0.9,0.34,0.61,0.34,0.12,0.14,0.83,0.21,0.15,0.08,0.66,0.59,0.48,0.14,0.57,0.71,0.84,0.25,0.21,0.56,0.97,0.92,0.46,0.01,0.91,0.92,0.25,0.9,0.16,0.48,0.41,0.83,0.7,0.08,0.66,0.07,0.16,0.43,0.1,0.4,0.73,0.97,0.01,0.59,0.73,0.04,0.54,0.95,0.53,0.08,0.74,0.55,0.71,0.58,0.78,0.36,0.22,0.14,0.42,0.67,0.27,0.24,0.99,0.3,0.12,0.97,0.92,0.9,0.62,0.21,0.99,0.58,0.91,0.89,0.99,0.27,0.23,0.5,0.01,0.1,0.98,0.31,0.15,0.69,0.57,0.19,0.13,0.56,0.72,0.87,0.64,0.23,0.02,0.4,0.99,0.72,0.76,0.91,0.85,0.94,0.53,0.53,0.14,0.06,0.86,0.32,0.12,0.83,0.54,0.13,0.04,0.08,0.83,0.82,0.72,0.63,0.26,0.38,0.49,0.01,0.78,0.13,0.42,0.4,0.11,0.72,0.51,0.4,0.9,0.4,0.44,0,0.28,0.22,0.34,0.38,0.56,0.41,0.6,0.23,0.42,0.31,0.19,0.67,0.59,0.02,0.46,0.28,0.3,0.86,0.82,0.72,0.37,0.23,0.54,0.37,0.81,0.47,0.83,0.98,0.76,0.25,0.18,0.22,0.12,0.65,0.06,0.61,0.05,0.47,0.24,0.87,0.82,0.31,0.09,0.67,0.48,0.05,0.27,0.77,0.42,0.67,0.29,0.19,0.44,0.24,0.95,0.01,0.45,0.94,0.56,0.81,0.4,0.84,0.43,0.72,0.68,0.15,0.7,0.17,0.5,0.78,0.34,0.25,0.9,0.14,0.34,0.36,0.74,0.18,0.1,0.75,0.31,0.71,0.22,0.24,0.54,0.12,0.32,0.54,0.32,0.43,0.4,0.46,0.88,0.5,0.02,0.24,0.49,0.46,0.52,0.88,0.07,0.75,0.79,0.23,0.39,0.11,0.35,0.84,0.3,0.26,0.78,0.32,0.55,0.21,0.71,0.36,0.07,0.51,0.35,0.67,0.18,0.75,0.05,0.56,0.7,0.83,0.72,0.7,0.11,0.11,0.32,0.59,0.8,0.49,0.98,0.31,0.88,0.42,0.72,0.58,0.84,0.43,0.32,0.72,0.99,0.48,0.72,0.53,0.14,0.79,0.21,0.95,0.48,0.98,0.03,0.93,0.94,0.26,0.65,0.19,0.42,0.28,0.73,0.83,0.16,0.19,0.29,0.25,0.01,0.99,0.63,0.02,0.65,0.16,0.76,0.07,0.19,0.24,0.07,0.07,0.7,0.15,0.31,0.77,0.33,0.85,0.56,0.65,0.9,0.53,0.81,0.6,0.44,0.81,0.55,0.44,0.03,0.26,0.9,0.68,0.21,0.67,0.81,0.45,0.95,0.84,0.46,0.22,0.19,0.85,0.42,0.25,0.92,0.12,0.51,0.62,0.53,0.42,0.92,0.75,0.21,0.63,0.36,0.51,0.78,0.52,0.53,0.15,0.81,0.7,0.11,0.06,0.1,0.91,0.13,0.51,0.98,0.68,0.41,0.34,0.52,0.85,0.2,0.72,0.51,0.99,0.71,0.95,0.75,0.13,0.36,0.55,0.41,0.34,0.65,0.49,0.63,0.37,0.96,0.61,0.34,0.46,0.99,0.21,0.36,0.9,0.32,0.82,0.6,0.04,0.92,0.34,0.26,0.69,0.18,0.22,0.07,0.29,0.62,0.07,0.75,0.94,0.04,0.91,0.87,0.5,0.86,0.48,0.89,0.31,0.66,0.16,0.35,0.91,0.66,0.4,0.86,0.59,0.94,0.61,0.33,0.66,0.77,0.23,0.54,0.91,0.31,0.66,0.14,0.39,0.5,0.35,0.21,0.3,0.95,0.11,0.86,0.43,0.9,0.19,0.56,0.11,0.17,0.87,0.96,0.08,0.61,0.89,0.18,0.5,0.48,0.46,0.55,0.13,0.95,0.7,0.78,0.91,0.38,0.19,0.83,0.82,0.77,0.15,0.35,0.24,0.64,0.07,0.77,0.72,0.46,0.79,0.89,0.17,0.6,0.04,0.15,0.04,0.78,0.17,0.86,0.36,0.57,0.43,0.97,0.52,0.5,0.24,0.01,0.24,0.64,1,0.75,0.17,0.74,0.63,0.34,0.25,0.18,0.9,0.06,0.27,0.38,0.13,0.4,0.16,0.59,0.92,0.64,0.3,0.27,0.54,0.47,0.48,0.98,0.5,0.38,0.99,0.75,0.52,0.65,0.42,0.48,0.85,0.17,0.95,0.61,0.88,0.66,0.94,0.48,0.83,0.5,0.08,0.35,0.02,0.4,0.49,0.44,0.38,0.16,0.74,0.85,0.38,0.05,0.04,0.76,0.75,0.86,0.16,0.71,0.62,0.49,0.79,0.98,0.31,0.62,0.19,0.77,0.87,0.98,0.35,0.74,0.93,0.33,0.88,0.03,0.5,0.1,0.9,0.77,0.64,0.05,0.01,0.76,0.64,0.87,0.62,0.21,0.73,0.72,0.76,0.43,0.61,0.62,0.27,0.12,0.84,0.99,0.84,0.21,0.44,0.08,0.3,0.84,0.66,0.5,0.3,0.29,0.9,0.93,0.86,0.62,0.61,0.3,0.2,0.07,0,0.66,0.96,0.39,0.8,0.73,0.78,0.02,0.36,0.46,0.59,0.38,0.57,0.73,0.41,0.44,0.53,0.42,0.66,0.91,0.41,0.45,0.85,0.16,0.34,0.07,0.21,0.04,0.37,0.99,0.31,0.76,0.45,0.82,0.88,0.75,0.42,0.84,0.21,0.67,0.2,0.67,0.21,0.92,0.73,0.99,0.8,0.29,0.55,0.93,0.78,0.14,0.56,0.44,0.71,0.76,0.38,0.79,0.41,0.17,0.51,0.75,1,0.08,0.7,0.54,0.87,0.5,0.55,0.96,0.4,0.98,0.43,0.63,0.85,0.9,0.06,0.65,0.16,0.75,0.66,0.33,0.94,0.85,0.23,0.15,0.79,0.89,0.9,0.58,0.16,0.37,0.68,0.98,0.94,0.27,0.96,0.14,0.1,0.57,0.42,0.13,0.72,0.71,0.16,0.67,0.77,0.32,0.34,0.82,0.85,0.58,0.96,0.59,0.3,0.26,0.31,0.65,0.21,0.87,0.21,0.26,0.73,0.73,0.44,0.21,0.87,0.55,0.98,0.66,0.81,0.88,0.27,0.55,0.81,0.54,0.99,0.28,0.72,0.37,0.4,0.85,0.16,0.76,0.26,0.24,0.86,0.1,0.33,0.39,0.03,0.48,0.81,0.97,0.09,0.13,0.36,0.71,0.74,0.54,0.51,0.85,0.73,0.8,0.31,0.75,0.1,0.12,0.05,0.21,0.32,0.02,0.54,0.2,0.91,0.23,0.43,0.34,0.03,0.01,0.08,0.5,0.83,0.65,0.77,0.23,0.66,0.21,0.78,0.39,0.3,0.67,0.78,0.22,0.49,0.81,0.93,0.61,0.22,0.98,0.58,0.43,0.83,0.71,0.25,0.49,0.12,0.34,0.62,0.87,0.47,0.13,0.49,0.66,0.54,0.4,0.16,0.81,0.27,0.98,0.31,0.36,0.54,0.2,0.4,0.68,0.03,0.58,0.36,0.92,0.19,0.53,0.58,0.67,0.58,0.19,0.49,0.47,0.34,0.62,0.72,0.15,0.63,0.4,0.66,0.67,0.95,0.64,0.88,0.52,0.5,0.38,0.14,0.75,0.19,0.75,0.01,0.13,0.16,0.31,0.07,0.3,0.32,0.42,0.67,0.41,0.72,0.09,0.61,0.69,0.5,0.85,0.36,0.35,0.3,0.1,0.32,0.35,0.82,0.85,0.19,0.29,0.41,0.26,0.83,0.11,0.88,0.09,0.92,0.17,0.5,0.12,0.26,0.79,0.94,0.57,0.07,0.39,0.83,0.9,0.83,0.43,0.1,0.14,0,0.01,0.52,0.74,0.9,0.15,0.77,0.26,0.58,0.47,0.83,0.06,0.85,0.94,0.47,0.96,0.29,0.31,0.73,0.45,0.4,0.73,0.32,0.98],
                topK: 5,
            );

            // 返回查詢結果
            return response()->json($response);

        } catch (Exception $e) {
            // 處理任何異常情況並返回錯誤響應
            return response()->json([
                'error' => $e->getMessage()
            ], 500);
        }
    }




    }



